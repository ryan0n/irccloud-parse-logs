#!/usr/bin/env php
<?php

namespace ryan0n\IrcCloudParseLogs;

use ryan0n\IrcCloudParseLogs\Export\ExportDriverFactory;
use ryan0n\IrcCloudParseLogs\Utility\IrcCloudParseLogs;
use \Exception;

require_once __DIR__ . '/../vendor/autoload.php';

try {
    // First stage zip file validation
    if (!$zipFileName = $argv[1]) {
        throw new Exception(
            'No zip file given.'
            . 'Usage: ./irccloud-parse-logs/bin/parse ./irccloud-export-11111-2017-12-20-15-19-11.zip'
        );
    }

    $objParser = new IrcCloudParseLogs(
        $zipFileName,
        ExportDriverFactory::factory('Json')
    );

    $objParser->run();
} catch (Exception $e) {
    echo "\n" . 'Error happened processing zip file: ' . $e->getMessage() . "\n\n";
}
